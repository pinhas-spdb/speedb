# This workflow will build Speedb on a Windows server
#
# This workflow assumes the self hosted runner on a Windows machine is ready.
# The Windows server must have all the tools and software required for Speedb building to be installed


name: Build on Windows 

on:
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: win1 # a test self hosted runner on a win vm
    steps:
    - name: 'Checkout GitHub Action'
      uses: actions/checkout@v3

    - name: 'build and present'
      shell: powershell # For Linux, use bash
      run: |
        $env:THIRDPARTY_HOME='C:/Users/builder/code'
        cp  $env:THIRDPARTY_HOME\thirdparty.inc .   # copy the thirdparty.inc that reflects the env on the runner machine
        mkdir runner_bld
        cd runner_bld
        cmake -G "Visual Studio 17 2022" -A x64 -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_STANDARD=20 -DJNI=1 -DGFLAGS=1 -DSNAPPY=1 -DLZ4=1 -DZLIB=1 -DZSTD=1 -DXPRESS=1 -DFAIL_ON_WARNINGS=0 ..
        msbuild speedb.sln /p:Configuration=Release /t:speedbjni-shared
